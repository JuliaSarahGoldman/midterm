<meta charset="utf-8"><!-- -*- markdown -*- -->        
        **Procedurally Generated Coral**
        **John Freeman (jcf1@williams.edu), Jose Rivas (jdr3@williams.edu),** 
        **Julia Goldman (jdg2@williams.edu),**
        **and Matheus de Carvalho Souza (mc13@williams.edu)** 

Introduction
================================

![Figure [teaser]: A Procedurally Generated Underwater Corral Reef using a Lindenmayer System.](evocativeTeaser.png border=1)

![Basic generation example](http://teampisces.weebly.com/uploads/3/0/7/3/30733957/1899336_orig.gif)

This program will procedurally generate distinct species of corral using a Lindernmeyer System (L-system). By specifying the species and specifying a color, we can generate unique corral and anenomes that will look amazing in any underwater environment. Corral and anenomes, like trees, can be represented as a recursive structure made of cylinders that shrink as they go farther from the base. Thus, an L-System can be used to model Corral and anenomes. In order to avoid having an exponential number of polygons as we recurse, we model the L-systems in 2D, generating a bump map for each coral as we do so. Then, we create a billboard for each piece of coral, with a material that has the colored image of the coral as its lambertian and the bump map as the bump.

Specification ##Needs to be longer
============================================================================================

Procedurally generate realistic coral using "Billboard" Texture and Normal Maps. 

1. Scene Generation:
  1. Create different 2D images representing different species of coral with slight variations.
  2. Write a scene file that puts gnerated lambertian and bump on a model in an underwater setting.
  3. Add fish models in the scene to make it look realistic.

2. Code:
  1. Create a class that can be used to create 2D images, including desired gradiants.
  2. Create a class generates2D coral using L-systems.
  3. Write code to procedurally generate interesting scenes using our coral.

3. Correctness Results:
    1. For each type of coral, show the lambertian image, the bump image, and a simple shot of the resulting coral.
    3. Take a picture coral from an angle with the mesh visible to demonstrate billboards.

4. Demonstration Results:
  1. A scene with multiple coral in a fishtank with fish.
  2. Close ups of the same scene, such as a particular fish hiding among some coral.

7. Evocative Result:
  1. Create a beautiful, unique scene that demonstrates the beauty of our creations. Put the coral in the ocean with shadows and fish going around to make it look like a real ocean scene.
  2. Render the image using a path tracer in 1024x720 resolution using 1024 paths and 6 scattering events.

Topic Overview
=====================================================================================
To generate practical coral models, we use: 
- L-system: specifies coral structure; 
- Billboards: to generate "light weight" models; 
- Image generation through adapted **rasterization** techniques.

L-System
------------------------------------------------------------------------------------
The Lindenmayer (L) systems are mainly used for generating fractals and realistic modeling of plants. 

An L-system consists of: 
- A set of variables: nonterminals that can be replaced by production rules.
- A set of constants: terminals. Constants are any of the following symbols:!, [, ], +, -.
- A single axiom which is a string composed of some number of variables and constants. The axiom is the initial state of the system. 
- A set of production rules defining the way variables can be replaced with combinations of constants and other variables. A production consists of two strings - the predecessor and the successor. The most interesting L-systems are defined by recursive production rules (i.e. rules that include the replaced variable along with other variable and constant combinations). 

[source](http://www.cs.unm.edu/~joel/PaperFoldingFractal/L-system-rules.html): Castellanos, Joel. "Lindenmayer Systems: Details." L-System Rules. The University of New Mexico, Computer Science, n.d. Web. 12 Oct. 2016.

This project used L-systems as the base for creating different coral models. 

![L-System generated plant](L-system2.png width=200px) ![L-System generated plant](L-system1.png width=200px) ![Our simple L-system](2016-10-09_001_4-midterm_r1505_g3d_r875___.png width=200px) ![our crazy L-system](2016-10-09_004_4-midterm_r1512_g3d_r875___.png width=200px)

L-systems are used to generate relistic tree models by describing the branching of the tree.

Billboards
------------------------------------------------------------------------------------
Billboards are shaded 2D images used in 3D graphics. These 2D images are often used to simulate 3D objects at lower rendering costs. 

Since our coral models are entirely created by following an L-system, with different recursion depths and recursive rules it would be impractical to create them entirely out of actual 3D polygons, which would create extensive triangle meshes and be heavy to render. Instead we used Billboards to achive the same effect with low tessalation. 

We generate many 3D-looking 2D images of a given coral, then paste them onto flat cubes (the billboards), and intersect them in their centers at different angles. This generates the illusion of a 3D coral that looks slightly different from different angles, within the wireframe of a few cubes instead of many cylinders. 

![Perpendicular billboards wireframe](2016-10-10_008_4-midterm_r1536_g3d_r875__.jpg width=200px) ![Billboard Coral 1](1.jpg width=200px) ![Billboard coral 2](coral_example.jpg width=200px)

3D-looking 2D images were created out of 2 images: one specifying the color, and the other specifying a bump map. The two images were then respectively assigned to the lambertian and bump parameters of the billboard model within the scene file.

Rasterization (partial)
-----------------------------------------------------------------------------------
Used to create Billboard lambertian and bump images. 

Rasterization describes a technique to fill out the pixels of a 2D image accorsing to what is visible in a 3D space. 

We use rasterization's pixel filling techniques to create arbitrary color and bump map images for our corals according to the L-system. As described in the Design section, our algorithm consists mainly of helper methods that draw different types of thicklines around the L-system. 

![Thin lines](2016-10-07_000_4-midterm_r1473_g3d_r875___.png width = 200px) ![Thick color lines](2016-10-12_002_4-midterm_r1571_g3d_r875_.png width=200px) ![Thick bump map lines](2016-10-12_001_4-midterm_r1571_g3d_r875_.png width=200px) ![Color L-system](2016-10-12_004_4-midterm_r1571_g3d_r875_.png width=200px) ![Bump Map L-System](2016-10-12_003_4-midterm_r1571_g3d_r875_.png width=200px)

Design
=====================================================================================
##Update tables and descriptions, and add tables for the rest of our classes.
##We need to add Doxygen links too.

App makesd an instance of CoralGenerator which it uses to call writeCoral with 2 given images.  CoralGenerator then generates the coral using one of the generate methods specifying an L-System and writes the results of that generation to the images using an instance of the Rasterizor class' drawThickLine method.  Finally, App saves these two images and displays them as a billboard in our coral custom scene.

|Rasterizer: | |
|------------|---|
|DrawThickLine | Draws a line of a given width from one given point to another, in a given color on the color image, and in a gradient for the bump map. |
|inBounds | Checks if a pixel we want to draw is in within the image |
|setpixel | Sets a pixel at a given x-y coordinate to a given color |
|drawHLine | Draws a line between two points with the same y coordinate. |
|drawVLine | Draws a line between two points with the same x coordinate. |
|drawSteepLine | Draws a line steeper than 45 degrees. |
|drawFlatLine | Draws a line flatter than 45 degrees. |
|roundCorners | Rounds the corners of a thick line. |

|Coral Generator: | |
|--------------------------|---------------------------------------|
|writeCoral | Given two images, draws the coral lambertian and the accompanying bump map for a given type of coral |
|applyRules | Takes a set of tokens and expands each token based on the rules that are passed to it. |
|generateFingerCoral | generates coral based on a set of rules |
|generateThinCoral | generates coral based on a set of rules |
|generateCrazyCoral | generates coral based on a set of rules |

We have a seperate class called Rasterizer that is responsible for drawing lines onto an image and create a bump map.  This allows us to create billboards for coral that are drawn on a 2D plane but appear to look 3D from afar.  We seperated this class into it's own files in order to keep it seperate from the actual procedual generation giving the code better structure and allowing people to work on both the generation and the presentation of coral at the same time without the worry of conflicts.

We have another class called CoralGenerator which is responsible for computing the algorithms we are using to do the procedural generation of coral through L-Systems.  It has a public writeCoral method called from App which generates different types of coral and writes them two images for color and the bump map.  It uses a series of generate functions that specify different L-Systems that are passed to the applyRules method and allow us to create many different types of coral without much code.  The apply rules method was written such that it is able to create many different types of coral given different sets of rules, which makes the code for generating coral easy to read and add allows us to easily add new types of coral to be generated without changing any of our old code.

Results
=====================================================================================
The following are the results of our procedural generation. We first demonstrate that the coral we create is visually accurate. Each coral should look as realistic as possible using the "billboard" method. We then show our coral in various different scenes, including with modeled fish floating around them.

Correctness Results
-------------------------------------------------------------------------------------
##Regenerate image using current version of our coral.
![Coral 4](thin.png width=200px) ![Coral 5](thinMap.png width=200px) ![Coral 6](thinCoral.jpg width=200px) 

![Coral 4](finger.png width=200px) ![Coral 5](fingerMap.png width=200px) ![Coral 6](fingerCoral.jpg width=200px) 

![Coral 4](crazy.png width=200px) ![Coral 5](crazyMap.png width=200px) ![Coral 6](crazyCoral.jpg width=200px) 

![branching](https://s-media-cache-ak0.pinimg.com/236x/0e/fc/48/0efc481f279a344ab624e246698fcb83.jpg) ![Simple Form](http://teampisces.weebly.com/uploads/3/0/7/3/30733957/748404459.png?468)

Demonstration Images
-------------------------------------------------------------------------------------
![Coral forms](http://antoniosliapis.com//graphics/research/a_constructive_approach_for_the_generation_of_underwater_environments.png)

![Coral 1](1.jpg) 

![Coral2](2.jpg border=1) 

![Coral 3](3.png border=1) 

![Coral 4](coral_example.jpg border=1) 

![Coral 5](coral_example2.jpg border=1) 

![Coral 6](coral_example3.jpg border=1) 

![](http://wiki.seg.org/images/7/7f/Bleaching.jpg border=1)

![Shark image](http://c8.alamy.com/comp/BE348D/soft-coral-reef-and-hammerhead-sharks-dendronephthya-sphyrna-lewini-BE348D.jpg)

![Turtle image](http://2ap93t1x1l6e2f6gfo3ag4vw.wpengine.netdna-cdn.com/wp-content/uploads/2016/09/Sea-turtle-great-barrier-reef.jpg)


Schedule
===================================================================

|To Do| Date | Person|
|-----|------|-------|
|Report Draft | 7 Oct. 2016 | Jose|
|L-System Creation Draft| 10 Oct. 2016 | John|
|Bump Mapping Draft | 9 Oct. 2016 | Julia|
|Drawing Lines Draft | 9 Oct. 2016 | Matheus|
|2D Coral Creation Draft| 10 Oct. 2016 | All|
|Bump Mapping MVP | 11 Oct. 2016 | Julia|
|Drawing Lines MVP | 11 Oct. 2016 | Matheus|
|L-System Creation MVP | 11 Oct. 2016 | John|
|Create Scene Draft | 13 Oct. 2016 | Jose|
|Report MVP | 13 Oct. 2016 | Jose and Julia|
|L-System Creation Polish | 16 Oct. 2016 | John and Jose|
|Create Scene Polish | 15 Oct. 2016 | Jose|
|Bump Mapping Polish | 16 Oct. 2016 | Julia|
|Line Drawing Polish | 16 Oct. 2016 | Matheus|
|Create Scene Polish | 16 Oct. 2016 | Jose|
|Report Polish | 17 Oct. 2016 | All|

Change Log
===================================================================
1. Created initial plans. All 10/5
2. Using old CS 136 code changed to work with g3d directly in App. Julia 10/6
3. Created a separate class for our 2D rasterizer. Matheus 10/7
4. Using UniversalMaterials for lambertian and bump. Julia 10/8
5. Updated specification to say what we want to be able to make. Jose 10/8
6. Creating 2D L-systems in App using line drawing code. John 10/9
7. Created a separate class for genertaing L-systems. John 10/10
8. Created a separate class for generating 3D coral L-systems. Jose 10/13
9. Realized class for 3D coral was unecessary. Jose 10/14
10. Created a new class to print out different scenes with varying types of coral. Jose 10/15

<!-- Markdeep: -->
<style class="fallback">body{visibility:hidden;white-space:pre;font-family:monospace;}</style><script src="https://casual-effects.com/markdeep/latest/markdeep.min.js"></script><script>window.alreadyProcessedMarkdeep||(document.body.style.visibility="visible")</script>

<script src="../common.js"></script>