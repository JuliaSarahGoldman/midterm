<meta charset="utf-8"><!-- -*- markdown -*- -->        
        **Procedurally Generated Coral**
        **John Freeman (jcf1@williams.edu), Jose Rivas (jdr3@williams.edu),** 
        **Julia Goldman (jdg2@williams.edu),**
        **and Matheus de Carvalho Souza (mc13@williams.edu)** 

Introduction
================================

![Figure [teaser]: A Procedurally Generated Underwater Corral Reef using a Lindenmayer System.](evocativeTeaser.png border=1)

![Basic generation example](http://teampisces.weebly.com/uploads/3/0/7/3/30733957/1899336_orig.gif)

This program will procedurally generate distinct species of corral using a Lindernmeyer System (L-system). By specifying the species and specifying a color, we can generate unique corral and anenomes that will look amazing in any underwater environment. Corral and anenomes, like trees, can be represented as a recursive structure made of cylinders that shrink as they go farther from the base. Thus, an L-System can be used to model Corral and anenomes. In order to avoid having an exponential number of polygons as we recurse, we model the L-systems in 2D, generating a bump map for each coral as we do so. Then, we create a billboard for each piece of coral, with a material that has the colored image of the coral as its lambertian and the bump map as the bump.

Specification
============================================================================================

Procedurally generate realistic coral using "Billboard" Texture and Normal Maps. 

1. Make a user interface with the following controls:
  1. Integer number box for the total different amount of species of coral to appear in the image.
  2. Integer number box for the total number of coral to appear in the image.
  3. Check box for adding fish to the image.
  4. Check box for adding shadows.
  5. A "Generate Scene" Button to geneate the scene.

2. When the "Generate" button is pressed, the program:
  1. Immediately displays a waiting screen.
  2. Renders an image as described below and then displays it in a new window with proper gamma
     encoding.

3. Scene Generation:
  1. Create different object files representing different species of coral with slight variations.
  2. Write a scene file that puts the coral in an ocean like setting with a sun hitting the top.
  3. Add fish models in the scene to make it look realistic if the fish check box is checked.

4. Code:
  1. Create a class that generates both the 2D drawings of the coral and the 3d mapping for it.
  2. Define a method that generates the appropriate scene.

5. Correctness Results:
  1. Show the triangle mesh of a piece of coral, and demonstrate how it is being rotated.
  2. Show a piece of coral and its shadow and the direction of the light.
  3. Show a piece of coral along 4 different viewpoints.

6. Demonstration Results:
  1. A scene with multiple coral on a heightfield.
  2. A scene with coral and a few fish floating around.
  3. A scene with multiple coral that demonstrates their ability to form shadows.

7. Evocative Result:
  1. Create a beautiful, unique scene that demonstrates the beauty of our creations. Put the coral in the ocean with shadows and fish going around to make it look like a real ocean scene.
  2. Render the image using a path tracer in 1024x720 resolution using 1024 paths and 6 scattering events.

Topic Overview
=====================================================================================

Design
=====================================================================================

App makesd an instance of CoralGenerator which it uses to call writeCoral with 2 given images.  CoralGenerator then generates the coral using one of the generate methods specifying an L-System and writes the results of that generation to the images using an instance of the Rasterizor class' drawThickLine method.  Finally, App saves these two images and displays them as a billboard in our coral custom scene.

|Rasterizer: | |
|------------|---|
|DrawThickLine | Draws a line of a given width from one given point to another, in a given color on the color image, and in a gradient for the bump map. |
|inBounds | Checks if a pixel we want to draw is in within the image |
|setpixel | Sets a pixel at a given x-y coordinate to a given color |
|drawHLine | Draws a line between two points with the same y coordinate. |
|drawVLine | Draws a line between two points with the same x coordinate. |
|drawSteepLine | Draws a line steeper than 45 degrees. |
|drawFlatLine | Draws a line flatter than 45 degrees. |
|roundCorners | Rounds the corners of a thick line. |

|Coral Generator: | |
|--------------------------|---------------------------------------|
|writeCoral | Given two images, draws the coral lambertian and the accompanying bump map for a given type of coral |
|applyRules | Takes a set of tokens and expands each token based on the rules that are passed to it. |
|generateFingerCoral | generates coral based on a set of rules |
|generateThinCoral | generates coral based on a set of rules |
|generateCrazyCoral | generates coral based on a set of rules |

We have a seperate class called Rasterizer that is responsible for drawing lines onto an image and create a bump map.  This allows us to create billboards for coral that are drawn on a 2D plane but appear to look 3D from afar.  We seperated this class into it's own files in order to keep it seperate from the actual procedual generation giving the code better structure and allowing people to work on both the generation and the presentation of coral at the same time without the worry of conflicts.

We have another class called CoralGenerator which is responsible for computing the algorithms we are using to do the procedural generation of coral through L-Systems.  It has a public writeCoral method called from App which generates different types of coral and writes them two images for color and the bump map.  It uses a series of generate functions that specify different L-Systems that are passed to the applyRules method and allow us to create many different types of coral without much code.  The apply rules method was written such that it is able to create many different types of coral given different sets of rules, which makes the code for generating coral easy to read and add allows us to easily add new types of coral to be generated without changing any of our old code.

Results
=====================================================================================
The following are the results of our procedural generation. We first demonstrate that the coral we create is visually accurate. Each coral should look as realistic as possible using the "billboard" method. We then show our coral in various different scenes, including with modeled fish floating around them.

Correctness Results
-------------------------------------------------------------------------------------
![Coral 4](thin.png width=200px) ![Coral 5](thinMap.png width=200px) ![Coral 6](thinCoral.jpg width=200px) 

![Coral 4](finger.png width=200px) ![Coral 5](fingerMap.png width=200px) ![Coral 6](fingerCoral.jpg width=200px) 

![Coral 4](crazy.png width=200px) ![Coral 5](crazyMap.png width=200px) ![Coral 6](crazyCoral.jpg width=200px) 

![branching](https://s-media-cache-ak0.pinimg.com/236x/0e/fc/48/0efc481f279a344ab624e246698fcb83.jpg) ![Simple Form](http://teampisces.weebly.com/uploads/3/0/7/3/30733957/748404459.png?468)

Demonstration Images
-------------------------------------------------------------------------------------
![Coral forms](http://antoniosliapis.com//graphics/research/a_constructive_approach_for_the_generation_of_underwater_environments.png)

![Coral 1](1.jpg) 

![Coral2](2.jpg border=1) 

![Coral 3](3.png border=1) 

![Coral 4](coral_example.jpg border=1) 

![Coral 5](coral_example2.jpg border=1) 

![Coral 6](coral_example3.jpg border=1) 

![](http://wiki.seg.org/images/7/7f/Bleaching.jpg border=1)

![Shark image](http://c8.alamy.com/comp/BE348D/soft-coral-reef-and-hammerhead-sharks-dendronephthya-sphyrna-lewini-BE348D.jpg)

![Turtle image](http://2ap93t1x1l6e2f6gfo3ag4vw.wpengine.netdna-cdn.com/wp-content/uploads/2016/09/Sea-turtle-great-barrier-reef.jpg)


Schedule
===================================================================

|To Do| Date | Person|
|-----|------|-------|
|Report Draft | 7 Oct. 2016 | Jose|
|L-System Creation Draft| 10 Oct. 2016 | John|
|Bump Mapping Draft | 9 Oct. 2016 | Julia|
|Drawing Lines Draft | 9 Oct. 2016 | Matheus|
|2D Coral Creation Draft| 10 Oct. 2016 | All|
|Creating 3D Draft | 10 Oct. 2016 | Jose|
|Bump Mapping MVP | 11 Oct. 2016 | Julia|
|Drawing Lines MVP | 11 Oct. 2016 | Matheus|
|L-System Creation MVP | 11 Oct. 2016 | John|
|Creating 3D MVP | 12 Oct. 2016 | Jose|
|Create Scene Draft | 13 Oct. 2016 | Jose|
|Report MVP | 13 Oct. 2016 | Jose and Julia|
|L-System Creation Polish | 16 Oct. 2016 | John and Jose|
|Create Scene Polish | 15 Oct. 2016 | Jose|
|Bump Mapping Polish | 16 Oct. 2016 | Julia|
|Line Drawing Polish | 16 Oct. 2016 | Matheus|
|Create Scene Polish | 16 Oct. 2016 | Jose|
|Report Polish | 17 Oct. 2016 | All|

Change Log
===================================================================
1. Created initial plans. All 10/5
2. Using old CS 136 code changed to work with g3d directly in App. Julia 10/6
3. Created a separate class for our 2D rasterizer. Matheus 10/7
4. Using UniversalMaterials for lambertian and bump. Julia 10/8
5. Updated specification to say what we want to be able to make. Jose 10/8
6. Creating 2D L-systems in App using line drawing code. John 10/9
7. Created a separate class for genertaing L-systems. John 10/10


<!-- Markdeep: -->
<style class="fallback">body{visibility:hidden;white-space:pre;font-family:monospace;}</style><script src="https://casual-effects.com/markdeep/latest/markdeep.min.js"></script><script>window.alreadyProcessedMarkdeep||(document.body.style.visibility="visible")</script>

<script src="../common.js"></script>